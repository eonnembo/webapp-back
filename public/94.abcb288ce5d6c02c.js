"use strict";(self.webpackChunksistema=self.webpackChunksistema||[]).push([[94],{3094:(yt,T,s)=>{s.r(T),s.d(T,{ServiciosModule:()=>Ht});var m=s(6895),l=s(433),A=s(4154),_=s(4325),b=s(805),q=s(5226),C=s.n(q),t=s(8256),g=s(9646),h=s(4004),f=s(262),D=s(2340),U=s(529);let H=(()=>{class a{constructor(i){this.http=i,this.baseUrl=D.N.baseUrl}traerDiasHorariosSucursal(i){return this.http.get(`${this.baseUrl}/dias-horarios/${i}`).pipe((0,h.U)(e=>e),(0,f.K)(e=>(0,g.of)(!1)))}static#t=this.\u0275fac=function(o){return new(o||a)(t.LFG(U.eN))};static#i=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})(),x=(()=>{class a{constructor(i){this.http=i,this.baseUrl=D.N.baseUrl}traerServicios(){return this.http.get(`${this.baseUrl}/servicio`).pipe((0,h.U)(o=>o),(0,f.K)(o=>(0,g.of)(!1)))}traerUnServicio(i){return this.http.get(`${this.baseUrl}/servicio/${i}`).pipe((0,h.U)(e=>e),(0,f.K)(e=>(0,g.of)(!1)))}buscarServicioClientePlan(i){return this.http.get(`${this.baseUrl}/servicio/buscar`,{params:i}).pipe((0,h.U)(e=>e),(0,f.K)(e=>(0,g.of)(!1)))}crearServicio(i){return this.http.post(`${this.baseUrl}/servicio`,i).pipe((0,h.U)(e=>e),(0,f.K)(e=>(0,g.of)(e.error)))}modificarServicioDiasHorarios(i){return this.http.put(`${this.baseUrl}/servicio/${i.id}`,i).pipe((0,h.U)(e=>e),(0,f.K)(e=>(0,g.of)(e.error)))}static#t=this.\u0275fac=function(o){return new(o||a)(t.LFG(U.eN))};static#i=this.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var Z=s(5593);function P(a,r){if(1&a&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&a){const i=r.$implicit;t.xp6(1),t.Oqu(i)}}const M=function(a,r,i){return{"cupo-disponible":a,"cupo-agotado":r,"celda-seleccionada":i}};function O(a,r){if(1&a){const i=t.EpF();t.TgZ(0,"td",16),t.NdJ("click",function(){const n=t.CHM(i).$implicit,c=t.oxw().$implicit,p=t.oxw();return t.KtG(p.asignarHorasDiasCupo(n,c))}),t._uU(1),t.qZA()}if(2&a){const i=r.$implicit,o=t.oxw().$implicit,e=t.oxw();t.Q6J("ngClass",t.kEZ(2,M,e.getCupoHora(i,o)>0,0===e.getCupoHora(i,o),e.isCellSelected(i,o))),t.xp6(1),t.hij(" ",e.getCupoHora(i,o)," ")}}function k(a,r){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.YNc(3,O,2,6,"td",15),t.qZA()),2&a){const i=r.$implicit,o=t.oxw();t.xp6(2),t.hij("",i," hs."),t.xp6(1),t.Q6J("ngForOf",o.diasDisponibles)}}const N=function(){return{margin:".5em",width:"9rem"}};let J=(()=>{class a{constructor(i,o,e,n,c){this.ref=i,this.config=o,this.confirmationService=e,this.diasHorariosSucursalService=n,this.serviciosService=c,this.diasAsistencia=0,this.plazoValidez=0,this.dataDiasHorarios=[],this.cambiosDataDiasHorarios=[]}ngOnInit(){this.dataDiasHorarios=this.config.data.diasHorarios,this.diasHorariosSucursalService.traerDiasHorariosSucursal(this.config.data.idSucursal).subscribe(i=>{this.diasHorasSucursal=i,this.originaldiasHorasSucursal=JSON.parse(JSON.stringify(i)),this.plazoValidez=i[0].plazoValidez,this.diasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(o=>o.dias))),this.horasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(o=>o.horas)))})}getCupoHora(i,o){const e=this.diasHorasSucursal.find(n=>n.dias===i&&n.horas===o);return e?e.cupoHora:0}asignarHorasDiasCupo(i,o){const e=this.diasHorasSucursal.find(n=>n.dias===i&&n.horas===o);if(e){const c=Object.values(this.dataDiasHorarios).some(d=>d.id===e.id);this.cambiosDataDiasHorarios?.find(d=>d.id===e.id)?(this.cambiosDataDiasHorarios=this.cambiosDataDiasHorarios.filter(d=>d.id!==e.id),this.cambiosDataDiasHorarios.push(e)):this.cambiosDataDiasHorarios.push(e),c?e.cupoHora>0&&(e.cupoHora--,this.diasAsistencia++,this.dataDiasHorarios=this.dataDiasHorarios.filter(d=>d.id!==e.id)):this.diasAsistencia>0&&(e.cupoHora++,this.diasAsistencia--,this.dataDiasHorarios.push({id:e.id,dia:e.dias,hora:e.horas,cupoHora:1}))}}isCellSelected(i,o){console.log("\u{1f60f} ~ isCellSelected ~ this.dataDiasHorarios:",this.dataDiasHorarios);const e=Object.values(this.dataDiasHorarios);console.log("\u{1f60f} ~ isCellSelected ~ dataArray:",e);const n=e.some(c=>c.dia===i&&c.hora===o);return console.log("\u{1f60f} ~ isCellSelected ~ isSelected:",n),n}trackByHora(i,o){return o}trackByDia(i,o){return o}confirmarCambiosCupo(){this.idServicio=this.config.data.id;const i=this.cambiosDataDiasHorarios.map(o=>({id:o.id,cupoHora:o.cupoHora,dia:o.dias,hora:o.horas}));this.serviciosService.modificarServicioDiasHorarios({id:this.idServicio,updDiasHorarios:i,diasHorarios:this.dataDiasHorarios}).subscribe(o=>{C().fire(o.msg,"",o.icon),o.ok&&this.closeForm()})}closeForm(){this.ref.close()}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(_.E7),t.Y36(_.S),t.Y36(b.YP),t.Y36(H),t.Y36(x))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-tabla-reserva-cliente"]],features:[t._Bn([b.YP])],decls:61,vars:14,consts:[[1,"col-12","px-0","mx-0","mb-3","w-100"],[1,"data-box"],[1,"data-item"],[1,"data-label"],[1,"data-value"],[1,"data-box","mt-3"],[1,"flex","justify-content-between","legend"],[1,"legend-item"],[1,"legend-color",2,"background-color","#ffaaaa"],[1,"legend-code"],[1,"legend-color",2,"background-color","#aaffaa"],[1,"legend-color",2,"background-color","#8bcae7"],[4,"ngFor","ngForOf"],[1,"text-center","col-12","p-3","m-0"],["label","Confirmar",3,"disabled","onClick"],["class","cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"ngClass","click"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),t._uU(4,"Nombre:"),t.qZA(),t.TgZ(5,"span",4),t._uU(6),t.qZA()(),t.TgZ(7,"div",2)(8,"span",3),t._uU(9,"Apellido:"),t.qZA(),t.TgZ(10,"span",4),t._uU(11),t.qZA()(),t.TgZ(12,"div",2)(13,"span",3),t._uU(14,"DNI:"),t.qZA(),t.TgZ(15,"span",4),t._uU(16),t.qZA()(),t.TgZ(17,"div",2)(18,"span",3),t._uU(19,"Email:"),t.qZA(),t.TgZ(20,"span",4),t._uU(21),t.qZA()(),t.TgZ(22,"div",2)(23,"span",3),t._uU(24,"Tel\xe9fono:"),t.qZA(),t.TgZ(25,"span",4),t._uU(26),t.qZA()(),t.TgZ(27,"div",2)(28,"span",3),t._uU(29,"Plan:"),t.qZA(),t.TgZ(30,"span",4),t._uU(31),t.qZA()(),t.TgZ(32,"div",2)(33,"span",3),t._uU(34,"Descripci\xf3n del plan:"),t.qZA(),t.TgZ(35,"span",4),t._uU(36),t.qZA()()(),t.TgZ(37,"div",5)(38,"div",6)(39,"span",7),t._UZ(40,"span",8),t._uU(41,"Sin asignar "),t._UZ(42,"span",9),t.qZA(),t.TgZ(43,"span",7),t._UZ(44,"span",10),t._uU(45,"Asignados "),t._UZ(46,"span",9),t.qZA(),t.TgZ(47,"span",7),t._UZ(48,"span",11),t._uU(49,"Seleccionado "),t._UZ(50,"span",9),t.qZA()()()(),t.TgZ(51,"table")(52,"thead")(53,"tr")(54,"th"),t._uU(55),t.qZA(),t.YNc(56,P,2,1,"th",12),t.qZA()(),t.TgZ(57,"tbody"),t.YNc(58,k,4,2,"tr",12),t.qZA()(),t.TgZ(59,"div",13)(60,"p-button",14),t.NdJ("onClick",function(){return e.confirmarCambiosCupo()}),t.qZA()()),2&o&&(t.xp6(6),t.Oqu(e.config.data.cliente.nombre),t.xp6(5),t.Oqu(e.config.data.cliente.apellido),t.xp6(5),t.Oqu(e.config.data.cliente.dni),t.xp6(5),t.Oqu(e.config.data.cliente.email),t.xp6(5),t.Oqu(e.config.data.cliente.telefono),t.xp6(5),t.Oqu(e.config.data.plan.nombre),t.xp6(5),t.Oqu(e.config.data.plan.descripcion),t.xp6(19),t.hij("Resta ",1==e.diasAsistencia?e.diasAsistencia+" d\xeda":e.diasAsistencia+" d\xedas",""),t.xp6(1),t.Q6J("ngForOf",e.diasDisponibles),t.xp6(2),t.Q6J("ngForOf",e.horasDisponibles),t.xp6(2),t.Akn(t.DdM(13,N)),t.Q6J("disabled",0!==e.diasAsistencia))},dependencies:[m.mk,m.sg,Z.zx],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:center;border:1px solid #ddd;width:100px}th[_ngcontent-%COMP%]{background-color:#f2f2f2}.cupo-disponible[_ngcontent-%COMP%]{background-color:#afa}.cupo-agotado[_ngcontent-%COMP%]{background-color:#faa}.celda-seleccionada[_ngcontent-%COMP%]{background-color:#8bcae7!important}.grid[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important}.legend[_ngcontent-%COMP%]{display:flex;justify-content:space-between}@media (max-width: 480px){.legend[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.legend-item[_ngcontent-%COMP%]{margin-bottom:10px}}.data-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.data-value[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}"]})}return a})();var I=s(4445),y=s(7101),w=s(3608),Y=s(2210),E=s(1236);function Q(a,r){1&a&&(t.TgZ(0,"div"),t._uU(1," Cliente requerido. "),t.qZA())}function $(a,r){if(1&a&&(t.TgZ(0,"div",12),t.YNc(1,Q,2,0,"div",3),t.qZA()),2&a){const i=t.oxw(2);let o;t.xp6(1),t.Q6J("ngIf",null==(o=i.miFormulario.get("idCliente"))?null:o.hasError("required"))}}const u=function(){return{margin:".5em",width:"9rem"}};function R(a,r){if(1&a){const i=t.EpF();t.ynx(0),t.TgZ(1,"div",4)(2,"label",5),t._uU(3,"Cliente"),t.TgZ(4,"span",6),t._uU(5,"*"),t.qZA()(),t._UZ(6,"p-dropdown",7),t.TgZ(7,"div",8),t.YNc(8,$,2,1,"div",9),t.qZA()(),t.TgZ(9,"div",10)(10,"p-button",11),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),t.qZA()(),t.BQk()}if(2&a){const i=t.oxw();let o;t.xp6(6),t.Q6J("options",i.clientes)("filter",!0)("showClear",!0),t.xp6(2),t.Q6J("ngIf",null==(o=i.miFormulario.get("idCliente"))?null:o.touched),t.xp6(2),t.Akn(t.DdM(7,u)),t.Q6J("disabled",i.miFormulario.get("idCliente").invalid)}}function z(a,r){1&a&&(t.TgZ(0,"div"),t._uU(1," Plan requerido. "),t.qZA())}function j(a,r){if(1&a&&(t.TgZ(0,"div",12),t.YNc(1,z,2,0,"div",3),t.qZA()),2&a){const i=t.oxw(2);let o;t.xp6(1),t.Q6J("ngIf",null==(o=i.miFormulario.get("idPlan"))?null:o.hasError("required"))}}function K(a,r){if(1&a){const i=t.EpF();t.ynx(0),t.TgZ(1,"div",4)(2,"label",13),t._uU(3,"Planes"),t.TgZ(4,"span",6),t._uU(5,"*"),t.qZA()(),t.TgZ(6,"p-dropdown",14),t.NdJ("onChange",function(e){t.CHM(i);const n=t.oxw();return t.KtG(n.selectedPlan(e))}),t.qZA(),t.TgZ(7,"div",8),t.YNc(8,j,2,1,"div",9),t.qZA()(),t.TgZ(9,"div",10)(10,"p-button",15),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),t.qZA(),t.TgZ(11,"p-button",11),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),t.qZA()(),t.BQk()}if(2&a){const i=t.oxw();let o;t.xp6(6),t.Q6J("options",i.planes)("filter",!0)("showClear",!0),t.xp6(2),t.Q6J("ngIf",null==(o=i.miFormulario.get("idPlan"))?null:o.touched),t.xp6(2),t.Akn(t.DdM(9,u)),t.xp6(1),t.Akn(t.DdM(10,u)),t.Q6J("disabled",i.miFormulario.get("idPlan").invalid)}}function B(a,r){if(1&a&&(t.TgZ(0,"th"),t._uU(1),t.qZA()),2&a){const i=r.$implicit;t.xp6(1),t.Oqu(i)}}const G=function(a,r,i){return{"cupo-disponible":a,"cupo-agotado":r,"celda-seleccionada":i}};function V(a,r){if(1&a){const i=t.EpF();t.TgZ(0,"td",27),t.NdJ("click",function(){const n=t.CHM(i).$implicit,c=t.oxw().$implicit,p=t.oxw(3);return t.KtG(p.asignarHorasDiasCupo(n,c))}),t._uU(1),t.qZA()}if(2&a){const i=r.$implicit,o=t.oxw().$implicit,e=t.oxw(3);t.Q6J("ngClass",t.kEZ(2,G,e.getCupoHora(i,o)>0,0===e.getCupoHora(i,o),e.isCellSelected(i,o))),t.xp6(1),t.hij(" ",e.getCupoHora(i,o)," ")}}function L(a,r){if(1&a&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.YNc(3,V,2,6,"td",26),t.qZA()),2&a){const i=r.$implicit,o=t.oxw(3);t.xp6(2),t.hij("",i," hs."),t.xp6(1),t.Q6J("ngForOf",o.diasDisponibles)}}function X(a,r){if(1&a&&(t.TgZ(0,"div",17)(1,"div",18)(2,"div",19)(3,"span",20),t._UZ(4,"span",21),t._uU(5,"Sin asignar "),t._UZ(6,"span",22),t.qZA(),t.TgZ(7,"span",20),t._UZ(8,"span",23),t._uU(9,"Asignados "),t._UZ(10,"span",22),t.qZA(),t.TgZ(11,"span",20),t._UZ(12,"span",24),t._uU(13,"Seleccionado "),t._UZ(14,"span",22),t.qZA()()(),t.TgZ(15,"table")(16,"thead")(17,"tr")(18,"th"),t._uU(19),t.qZA(),t.YNc(20,B,2,1,"th",25),t.qZA()(),t.TgZ(21,"tbody"),t.YNc(22,L,4,2,"tr",25),t.qZA()()()),2&a){const i=t.oxw(2);t.xp6(19),t.hij("Resta ",1==i.diasAsistencia?i.diasAsistencia+" d\xeda":i.diasAsistencia+" d\xedas",""),t.xp6(1),t.Q6J("ngForOf",i.diasDisponibles),t.xp6(2),t.Q6J("ngForOf",i.horasDisponibles)}}function W(a,r){if(1&a){const i=t.EpF();t.ynx(0),t.YNc(1,X,23,3,"div",16),t.TgZ(2,"div",10)(3,"p-button",15),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),t.qZA(),t.TgZ(4,"p-button",11),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),t.qZA()(),t.BQk()}if(2&a){const i=t.oxw();t.xp6(1),t.Q6J("ngIf",i.diasHorasSucursal.length>0),t.xp6(2),t.Akn(t.DdM(6,u)),t.xp6(1),t.Akn(t.DdM(7,u)),t.Q6J("disabled",0!==i.diasAsistencia)}}function tt(a,r){if(1&a){const i=t.EpF();t.ynx(0),t.TgZ(1,"div",28)(2,"h3",29),t._uU(3,"\xbfConfirmar reserva?"),t.qZA()(),t.TgZ(4,"div",10)(5,"p-button",15),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),t.qZA(),t._UZ(6,"p-button",30),t.TgZ(7,"p-button",31),t.NdJ("onClick",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.closeForm())}),t.qZA()(),t.BQk()}if(2&a){const i=t.oxw();t.xp6(5),t.Akn(t.DdM(7,u)),t.xp6(1),t.Akn(t.DdM(8,u)),t.Q6J("disabled",i.miFormulario.invalid),t.xp6(1),t.Akn(t.DdM(9,u))}}let F=(()=>{class a{constructor(i,o,e,n,c,p){this.ref=i,this.fb=o,this.clienteService=e,this.planService=n,this.diasHorariosSucursalService=c,this.serviciosService=p,this.currentStep=0,this.idPlan=0,this.importe=0,this.diasAsistencia=0,this.dataDiasHorarios=[],this.cambiosDataDiasHorarios=[],this.miFormulario=this.fb.group({idCliente:new l.NI({value:"",disabled:!1},[l.kI.required]),idPlan:new l.NI({value:"",disabled:!1},[l.kI.required]),importe:new l.NI({value:0,disabled:!1},[l.kI.required]),diasHorarios:new l.NI({value:"",disabled:!1}),updDiasHorarios:new l.NI({value:"",disabled:!1}),fechaInicio:new l.NI({value:null,disabled:!1}),fechaFin:new l.NI({value:null,disabled:!1})}),this.clienteService.traerClientes().subscribe(d=>{this.clientes=d.filter(S=>S.estado)}),this.planService.traerPlanes().subscribe(d=>{this.planes=d.filter(S=>S.estado)})}ngOnInit(){this.items=[{label:"Cliente"},{label:"Planes"},{label:"D\xedas y horarios"},{label:"Confirmaci\xf3n"}]}avanzarAlSiguientePaso(i){this.currentStep=i+=1}selectedPlan(i){this.idPlan=i.value.id;const o=this.miFormulario.get("idCliente").value;this.serviciosService.buscarServicioClientePlan({idCliente:o,idPlan:this.idPlan}).subscribe(n=>{n.ok&&(C().fire(n.msg,"",n.icon),this.miFormulario.patchValue({idPlan:null}))}),this.importe=i.value.importe;const e=i.value.idSucursal;this.diasAsistencia=i.value.diasAsistencia,this.diasHorariosSucursalService.traerDiasHorariosSucursal(e).subscribe(n=>{this.diasHorasSucursal=n,this.diasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(c=>c.dias))),this.horasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(c=>c.horas)))})}getCupoHora(i,o){const e=this.diasHorasSucursal.find(n=>n.dias===i&&n.horas===o);return e?e.cupoHora:0}asignarHorasDiasCupo(i,o){const e=this.diasHorasSucursal.find(n=>n.dias===i&&n.horas===o);if(e){const c=Object.values(this.dataDiasHorarios).some(d=>d.id===e.id);this.cambiosDataDiasHorarios?.find(d=>d.id===e.id)?(this.cambiosDataDiasHorarios=this.cambiosDataDiasHorarios.filter(d=>d.id!==e.id),this.cambiosDataDiasHorarios.push(e)):this.cambiosDataDiasHorarios.push(e),c?e.cupoHora>0&&(e.cupoHora--,this.diasAsistencia++,this.dataDiasHorarios=this.dataDiasHorarios.filter(d=>d.id!==e.id)):this.diasAsistencia>0&&(e.cupoHora++,this.diasAsistencia--,this.dataDiasHorarios.push({id:e.id,dia:e.dias,hora:e.horas,cupoHora:1}))}}isCellSelected(i,o){return Object.values(this.dataDiasHorarios).some(c=>c.dia===i&&c.hora===o)}guardar(){const i=this.cambiosDataDiasHorarios.map(o=>({id:o.id,dia:o.dias,hora:o.horas,cupoHora:o.cupoHora}));this.miFormulario.patchValue({idPlan:this.idPlan,importe:this.importe,updDiasHorarios:i,diasHorarios:this.dataDiasHorarios}),this.serviciosService.crearServicio(this.miFormulario.value).subscribe(o=>{C().fire(o.msg,"",o.icon),o.ok&&this.closeForm()})}closeForm(){this.ref.close()}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(_.E7),t.Y36(l.qu),t.Y36(I.$),t.Y36(y.D),t.Y36(H),t.Y36(x))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-formulario-servicios"]],decls:7,vars:8,consts:[[3,"model","readonly","activeIndex"],["autocomplete","off",1,"pt-2",3,"formGroup","ngSubmit"],[1,"grid"],[4,"ngIf"],[1,"col-12","lg:col-6","p-3","m-0","mt-3"],["htmlFor","idCliente"],["pTooltip","Requerido","tooltipPosition","top",1,"required"],["formControlName","idCliente","optionLabel","nombre","optionValue","id","filterBy","nombre","placeholder","Seleccione cliente","appendTo","body","emptyFilterMessage","Sin resultados","emptyMessage","Sin resultados",3,"options","filter","showClear"],[1,"h-1rem"],["class","error-message",4,"ngIf"],[1,"text-center","col-12","p-3","m-0"],["label","Siguiente",3,"disabled","onClick"],[1,"error-message"],["htmlFor","idPlan"],["formControlName","idPlan","optionLabel","nombre","filterBy","nombre","placeholder","Seleccione plan","appendTo","body","emptyFilterMessage","Sin resultados","emptyMessage","Sin resultados",3,"options","filter","showClear","onChange"],["label","Anterior",3,"onClick"],["class","col-12 mt-3 mb-3 w-100",4,"ngIf"],[1,"col-12","mt-3","mb-3","w-100"],[1,"data-box","mt-3","mb-3"],[1,"flex","justify-content-between","legend"],[1,"legend-item"],[1,"legend-color",2,"background-color","#ffaaaa"],[1,"legend-code"],[1,"legend-color",2,"background-color","#aaffaa"],[1,"legend-color",2,"background-color","#8bcae7"],[4,"ngFor","ngForOf"],["class","cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"ngClass","click"],[1,"text-center","col-12","p-3","m-0","mt-3"],[1,"m-5"],["label","Confirmar","type","submit","icon","pi pi-check","styleClass","p-button-success",3,"disabled"],["label","Cancelar","icon","pi pi-times","styleClass","p-button-secondary",3,"onClick"]],template:function(o,e){1&o&&(t._UZ(0,"p-steps",0),t.TgZ(1,"form",1),t.NdJ("ngSubmit",function(){return e.guardar()}),t.TgZ(2,"div",2),t.YNc(3,R,11,8,"ng-container",3),t.YNc(4,K,12,11,"ng-container",3),t.YNc(5,W,5,8,"ng-container",3),t.YNc(6,tt,8,10,"ng-container",3),t.qZA()()),2&o&&(t.Q6J("model",e.items)("readonly",!0)("activeIndex",e.currentStep),t.xp6(1),t.Q6J("formGroup",e.miFormulario),t.xp6(2),t.Q6J("ngIf",0===e.currentStep),t.xp6(1),t.Q6J("ngIf",1===e.currentStep),t.xp6(1),t.Q6J("ngIf",2===e.currentStep),t.xp6(1),t.Q6J("ngIf",3===e.currentStep))},dependencies:[m.mk,m.sg,m.O5,l._Y,l.JJ,l.JL,l.sg,l.u,w.u,Z.zx,Y.Lt,E.R],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:center;border:1px solid #ddd;width:100px}th[_ngcontent-%COMP%]{background-color:#f2f2f2}.cupo-disponible[_ngcontent-%COMP%]{background-color:#afa}.cupo-agotado[_ngcontent-%COMP%]{background-color:#faa}.celda-seleccionada[_ngcontent-%COMP%]{background-color:#8bcae7!important}.grid[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important}.legend[_ngcontent-%COMP%]{display:flex;justify-content:space-between}@media (max-width: 480px){.legend[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.legend-item[_ngcontent-%COMP%]{margin-bottom:10px}}.data-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.data-value[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}"]})}return a})();class v extends Error{}v.prototype.name="InvalidTokenError";var at=s(7154),nt=s(2137),rt=s(308),st=s(6679),ct=s(1740),lt=s(4424),dt=s(7248),pt=s(1493),ut=s(8741),mt=s(6526),gt=s(5793);function ht(a,r){if(1&a){const i=t.EpF();t.TgZ(0,"div",16)(1,"span",17),t._UZ(2,"i",18),t.TgZ(3,"input",19),t.NdJ("input",function(e){t.CHM(i),t.oxw();const n=t.MAs(6);return t.KtG(n.filterGlobal(e.target.value,"contains"))}),t.qZA()(),t.TgZ(4,"span")(5,"button",20),t.NdJ("click",function(){t.CHM(i);const e=t.oxw();return t.KtG(e.show())}),t.qZA()()()}}function ft(a,r){1&a&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"Nombre"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"DNI"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"Plan"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"Fecha inicio"),t.qZA(),t.TgZ(9,"th"),t._uU(10,"Fecha fin"),t.qZA(),t.TgZ(11,"th",21),t._uU(12,"D\xedas restantes"),t.qZA(),t.TgZ(13,"th",21),t._uU(14,"Importe"),t.qZA(),t.TgZ(15,"th",21),t._uU(16,"Cobro"),t.qZA(),t.TgZ(17,"th",22),t._uU(18,"Estado"),t.qZA(),t._UZ(19,"th"),t.qZA())}function _t(a,r){if(1&a){const i=t.EpF();t.TgZ(0,"tr")(1,"td")(2,"span",23),t._uU(3,"Nombre"),t.qZA(),t._uU(4),t.qZA(),t.TgZ(5,"td")(6,"span",23),t._uU(7,"DNI"),t.qZA(),t._uU(8),t.ALo(9,"dniFormat"),t.qZA(),t.TgZ(10,"td")(11,"span",23),t._uU(12,"Plan"),t.qZA(),t.TgZ(13,"div",24),t._uU(14),t.qZA()(),t.TgZ(15,"td")(16,"span",23),t._uU(17,"Fecha inicio"),t.qZA(),t._uU(18),t.qZA(),t.TgZ(19,"td")(20,"span",23),t._uU(21,"Fecha fin"),t.qZA(),t._uU(22),t.qZA(),t.TgZ(23,"td",21)(24,"span",23),t._uU(25,"D\xedas restantes"),t.qZA(),t._uU(26),t.qZA(),t.TgZ(27,"td",21)(28,"span",23),t._uU(29,"Importe"),t.qZA(),t._uU(30),t.qZA(),t.TgZ(31,"td",21)(32,"span",23),t._uU(33,"Cobro"),t.qZA(),t._uU(34),t.qZA(),t.TgZ(35,"td",22)(36,"span",23),t._uU(37,"Estado"),t.qZA(),t._UZ(38,"p-tag",25),t.qZA(),t.TgZ(39,"td",26)(40,"p-speedDial",27),t.NdJ("onClick",function(){const n=t.CHM(i).$implicit,c=t.oxw();return t.KtG(c.accionBoton(n))}),t.qZA()()()}if(2&a){const i=r.$implicit,o=r.rowIndex,e=t.oxw();t.xp6(4),t.Oqu(null==i.cliente?null:i.cliente.nombre),t.xp6(4),t.Oqu(t.lcZ(9,12,null==i.cliente?null:i.cliente.dni)),t.xp6(5),t.s9C("pTooltip",null==i.plan?null:i.plan.descripcion),t.xp6(1),t.hij(" ",null==i.plan?null:i.plan.nombre,""),t.xp6(4),t.Oqu(i.fechaInicio),t.xp6(4),t.Oqu(i.fechaFin),t.xp6(4),t.Oqu(i.diasRestantes),t.xp6(4),t.hij("$",i.importe,""),t.xp6(4),t.hij("$",i.cobro?i.cobro:0,""),t.xp6(4),t.Q6J("value",i.estado)("severity",e.getSeverity(i.estado)),t.xp6(2),t.Q6J("model",e.items[o])}}function vt(a,r){1&a&&(t.TgZ(0,"tr")(1,"td",28),t._uU(2,"No se encontraron registros"),t.qZA()()),2&a&&(t.xp6(1),t.uIk("colspan",9))}const bt=function(){return{"min-width":"20rem"}},Ct=function(){return["cliente.nombre","cliente.dni","plan.nombre","estado"]},Zt=function(){return[10,25,50]},xt=function(){return{width:"50vw"}},St=function(){return{margin:".5em",width:"9rem"}},Tt=[{path:"",children:[{path:"",component:(()=>{class a{constructor(i,o,e,n){this.serviciosService=i,this.planService=o,this.pagoService=e,this.dialogService=n,this.items=[],this.servicios=[],this.visible=!1,this.importeCobrado=0,this.importeMax=0}ngOnInit(){const o=function ot(a,r){if("string"!=typeof a)throw new v("Invalid token specified: must be a string");r||(r={});const i=!0===r.header?0:1,o=a.split(".")[i];if("string"!=typeof o)throw new v(`Invalid token specified: missing part #${i+1}`);let e;try{e=function et(a){let r=a.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function it(a){return decodeURIComponent(atob(a).replace(/(.)/g,(r,i)=>{let o=i.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(r)}catch{return atob(r)}}(o)}catch(n){throw new v(`Invalid token specified: invalid base64 for part #${i+1} (${n.message})`)}try{return JSON.parse(e)}catch(n){throw new v(`Invalid token specified: invalid json for part #${i+1} (${n.message})`)}}(localStorage.getItem("token"));this.idUsuario=o.id,this.traerServicios()}accionBoton(i){this.planService.traerUnPlan(i.idPlan).subscribe(o=>{this.dataCliente={...i,idSucursal:o.idSucursal}})}traerServicios(){this.subscription=this.serviciosService.traerServicios().subscribe(i=>{this.servicios=i.sort((o,e)=>e.id-o.id),this.preCalcularValores(),this.items=this.servicios.map(o=>{const e=[{icon:"pi pi-id-card",tooltipOptions:{tooltipLabel:"Ver reserva",tooltipPosition:"top"},command:()=>{this.showHorasDias(this.dataCliente)}}];return"activo"!==o.estado&&e.push({icon:"pi pi-dollar",tooltipOptions:{tooltipLabel:"Pagar",tooltipPosition:"top"},command:()=>{this.visible=!0,this.importeCobrado=this.dataCliente.plan.importe-(this.dataCliente.cobro||0),this.importeMax=this.dataCliente.plan.importe-(this.dataCliente.cobro||0)}}),o.cliente.telefono&&e.push({icon:"pi pi-whatsapp",tooltipOptions:{tooltipLabel:"Enviar WhatsApp",tooltipPosition:"top"},command:()=>{const p=`https://wa.me/${this.dataCliente.cliente.telefono}?text=${encodeURIComponent(`Hola, \xbfc\xf3mo est\xe1s ${this.dataCliente.cliente.nombre}?`)}`;window.open(p,"_blank")}}),e})})}show(){this.ref=this.dialogService.open(F,{header:"Nuevo servicio",width:"70%",contentStyle:{overflow:"auto"},maximizable:!0,styleClass:"customer-dialog-form"}),this.ref.onClose.subscribe(()=>{this.traerServicios()})}showHorasDias(i){this.ref=this.dialogService.open(J,{header:"Reserva",width:"70%",contentStyle:{overflow:"auto"},maximizable:!0,styleClass:"customer-dialog-form",data:i}),this.ref.onClose.subscribe(()=>{this.traerServicios()})}getSeverity(i){switch(i){case"activo":return"success";case"parcial":return"warning";case"pago pendiente":return"danger";default:return""}}preCalcularValores(){this.servicios.forEach(i=>{i.diasRestantes=this.calcularDiasRestantes(i.fechaFin),i.estado=this.calcularEstado(i.cobro||0,i.plan.importe,i.diasRestantes)})}calcularDiasRestantes(i){const o=new Date(i+"T00:00:00-03:00"),e=new Date;if(e.setHours(0,0,0,0),isNaN(o.getTime()))return 0;const n=o.getTime()-e.getTime(),c=Math.floor(n/864e5);return Math.max(0,c)}calcularEstado(i,o,e){return 0===i||0===e?"pago pendiente":i<o?"parcial":"activo"}enviarCobro(){this.pagoService.crearPago({idServicio:this.dataCliente.id,idUsuario:this.idUsuario,importe:this.importeCobrado,plazoValidez:this.dataCliente.plan.plazoValidez,cobro:this.dataCliente.cobro}).subscribe(o=>{C().fire(o.msg,"",o.icon),o.ok&&(this.visible=!1,this.traerServicios())})}ngOnDestroy(){this.ref&&this.ref.close(),this.subscription.unsubscribe()}static#t=this.\u0275fac=function(o){return new(o||a)(t.Y36(x),t.Y36(y.D),t.Y36(at.e),t.Y36(_.xA))};static#i=this.\u0275cmp=t.Xpm({type:a,selectors:[["app-tabla-servicios"]],features:[t._Bn([_.xA,b.YP])],decls:23,vars:25,consts:[[1,"card"],["dataKey","id","responsiveLayout","stack","currentPageReportTemplate","{first} al {last} de {totalRecords}",3,"value","tableStyle","paginator","rows","showCurrentPageReport","globalFilterFields","rowsPerPageOptions"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"confirmation"],["header","Cobro de servicio",1,"customer-dialog-form",3,"visible","baseZIndex","modal","visibleChange"],[1,"pl-0","ml-0"],[1,"col-12","w-100","pl-0"],["htmlFor","importe",1,"m-0"],["pTooltip","Requerido","tooltipPosition","top",1,"required"],["inputId","importe","placeholder","$ 0,00","mode","currency","currency","ARS","locale","es-AR",1,"m-0",3,"ngModel","min","max","ngModelChange"],[1,"text-center","col-12","p-3","m-0"],["label","Cobrar","type","button","icon","pi pi-dollar","styleClass","p-button-success",3,"disabled","onClick"],[1,"flex","align-items-center","justify-content-between","my-0","py-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pButton","","pRipple","","icon","pi pi-plus","pTooltip","Nuevo servicio","tooltipPosition","left",1,"p-button-success","mr-2",3,"click"],[1,"text-right"],[1,"text-center"],[1,"p-column-title"],["tooltipPosition","top",1,"m-0","p-0","cursor-pointer",3,"pTooltip"],[1,"uppercase",3,"value","severity"],[1,"text-left"],["direction","left","showIcon","pi pi-ellipsis-h","hideIcon","pi pi-times",3,"model","onClick"],[1,"text-center",2,"color","grey"]],template:function(o,e){1&o&&(t._UZ(0,"app-tool-bar"),t.TgZ(1,"h1"),t._uU(2,"Servicios"),t.qZA(),t._UZ(3,"hr"),t.TgZ(4,"div",0)(5,"p-table",1,2),t.YNc(7,ht,6,0,"ng-template",3),t.YNc(8,ft,20,0,"ng-template",4),t.YNc(9,_t,41,14,"ng-template",5),t.YNc(10,vt,3,1,"ng-template",6),t.qZA()(),t._UZ(11,"app-footer")(12,"p-confirmDialog",7),t.TgZ(13,"p-dialog",8),t.NdJ("visibleChange",function(c){return e.visible=c}),t.TgZ(14,"div",9)(15,"div",10)(16,"label",11),t._uU(17,"Importe"),t.TgZ(18,"span",12),t._uU(19,"*"),t.qZA()(),t.TgZ(20,"p-inputNumber",13),t.NdJ("ngModelChange",function(c){return e.importeCobrado=c}),t.qZA()(),t.TgZ(21,"div",14)(22,"p-button",15),t.NdJ("onClick",function(){return e.enviarCobro()}),t.qZA()()()()),2&o&&(t.xp6(5),t.Q6J("value",e.servicios)("tableStyle",t.DdM(20,bt))("paginator",e.servicios.length>10)("rows",5)("showCurrentPageReport",!0)("globalFilterFields",t.DdM(21,Ct))("rowsPerPageOptions",t.DdM(22,Zt)),t.xp6(8),t.Akn(t.DdM(23,xt)),t.Q6J("visible",e.visible)("baseZIndex",19e3)("modal",!0),t.xp6(7),t.Udp("width",100,"%"),t.Q6J("ngModel",e.importeCobrado)("min",0)("max",e.importeMax),t.xp6(2),t.Akn(t.DdM(24,St)),t.Q6J("disabled",e.importeCobrado<=0))},dependencies:[l.JJ,w.u,b.jx,Z.Hq,Z.zx,nt.Q,rt.iA,st.V,ct.o,lt.V,dt.Rn,pt.V,ut.o,mt.c,l.On,gt.p],styles:["*[_ngcontent-%COMP%]{margin:15px}.card[_ngcontent-%COMP%]{border:1px solid var(--surface-border)!important;border-radius:12px!important}"]})}return a})()},{path:"form-servicios",component:F},{path:"**",redirectTo:"auth"}]}];let At=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[A.Bz.forChild(Tt),A.Bz]})}return a})();var Dt=s(6867),Ut=s(4466);let Ht=(()=>{class a{static#t=this.\u0275fac=function(o){return new(o||a)};static#i=this.\u0275mod=t.oAB({type:a});static#e=this.\u0275inj=t.cJS({imports:[m.ez,l.UX,At,Dt.g,Ut.m,l.u5]})}return a})()}}]);