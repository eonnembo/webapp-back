"use strict";(self.webpackChunksistema=self.webpackChunksistema||[]).push([[94],{3094:(qi,H,s)=>{s.r(H),s.d(H,{ServiciosModule:()=>Fi});var h=s(6895),p=s(433),C=s(4154),g=s(4325),f=s(805),N=s(5226),x=s.n(N),i=s(8256),_=s(9646),v=s(4004),b=s(262),U=s(2340),y=s(529);let w=(()=>{class a{constructor(t){this.http=t,this.baseUrl=U.N.baseUrl}traerDiasHorariosSucursal(t){return this.http.get(`${this.baseUrl}/dias-horarios/${t}`).pipe((0,v.U)(e=>e),(0,b.K)(e=>(0,_.of)(!1)))}static#i=this.\u0275fac=function(o){return new(o||a)(i.LFG(y.eN))};static#t=this.\u0275prov=i.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})(),S=(()=>{class a{constructor(t){this.http=t,this.baseUrl=U.N.baseUrl}traerServicios(){return this.http.get(`${this.baseUrl}/servicio`).pipe((0,v.U)(o=>o),(0,b.K)(o=>(0,_.of)(!1)))}traerUnServicio(t){return this.http.get(`${this.baseUrl}/servicio/${t}`).pipe((0,v.U)(e=>e),(0,b.K)(e=>(0,_.of)(!1)))}buscarServicioClientePlan(t){return this.http.get(`${this.baseUrl}/servicio/buscar`,{params:t}).pipe((0,v.U)(e=>e),(0,b.K)(e=>(0,_.of)(!1)))}crearServicio(t){return this.http.post(`${this.baseUrl}/servicio`,t).pipe((0,v.U)(e=>e),(0,b.K)(e=>(0,_.of)(e.error)))}modificarServicioDiasHorarios(t){return this.http.put(`${this.baseUrl}/servicio/${t.id}`,t).pipe((0,v.U)(e=>e),(0,b.K)(e=>(0,_.of)(e.error)))}static#i=this.\u0275fac=function(o){return new(o||a)(i.LFG(y.eN))};static#t=this.\u0275prov=i.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var T=s(5593);function k(a,r){if(1&a&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&a){const t=r.$implicit;i.xp6(1),i.Oqu(t)}}const J=function(a,r,t){return{"cupo-disponible":a,"cupo-agotado":r,"celda-seleccionada":t}};function I(a,r){if(1&a){const t=i.EpF();i.TgZ(0,"td",16),i.NdJ("click",function(){const n=i.CHM(t).$implicit,c=i.oxw().$implicit,d=i.oxw();return i.KtG(d.asignarHorasDiasCupo(n,c))}),i._uU(1),i.qZA()}if(2&a){const t=r.$implicit,o=i.oxw().$implicit,e=i.oxw();i.Q6J("ngClass",i.kEZ(2,J,e.getCupoHora(t,o)>0,0===e.getCupoHora(t,o),e.isCellSelected(t,o))),i.xp6(1),i.hij(" ",e.getCupoHora(t,o)," ")}}function Y(a,r){if(1&a&&(i.TgZ(0,"tr")(1,"td"),i._uU(2),i.qZA(),i.YNc(3,I,2,6,"td",15),i.qZA()),2&a){const t=r.$implicit,o=i.oxw();i.xp6(2),i.hij("",t," hs."),i.xp6(1),i.Q6J("ngForOf",o.diasDisponibles)}}const E=function(){return{margin:".5em",width:"9rem"}};let z=(()=>{class a{constructor(t,o,e,n,c){this.ref=t,this.config=o,this.confirmationService=e,this.diasHorariosSucursalService=n,this.serviciosService=c,this.diasAsistencia=0,this.plazoValidez=0,this.dataDiasHorarios=[],this.cambiosDataDiasHorarios=[]}ngOnInit(){this.dataDiasHorarios=this.config.data.diasHorarios,this.diasHorariosSucursalService.traerDiasHorariosSucursal(this.config.data.idSucursal).subscribe(t=>{this.diasHorasSucursal=t,this.plazoValidez=t[0].plazoValidez,this.diasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(o=>o.dias))),this.horasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(o=>o.horas)))})}getCupoHora(t,o){const e=this.diasHorasSucursal.find(n=>n.dias===t&&n.horas===o);return e?e.cupoHora:0}asignarHorasDiasCupo(t,o){const e=this.diasHorasSucursal.find(n=>n.dias===t&&n.horas===o);if(e){let n;if("string"==typeof this.dataDiasHorarios)try{n=JSON.parse(this.dataDiasHorarios)}catch(l){console.error("Error al convertir LONGTEXT a JSON:",l),n={}}else n=this.dataDiasHorarios;const d=Object.values(n).some(l=>l.id===e.id);this.cambiosDataDiasHorarios?.find(l=>l.id===e.id)?(this.cambiosDataDiasHorarios=this.cambiosDataDiasHorarios.filter(l=>l.id!==e.id),this.cambiosDataDiasHorarios.push(e)):this.cambiosDataDiasHorarios.push(e),d?e.cupoHora>0&&(e.cupoHora--,console.log("\u{1f60f} ~ asignarHorasDiasCupo ~ item.cupoHora:",e.cupoHora),this.diasAsistencia++,this.dataDiasHorarios=this.dataDiasHorarios.filter(l=>l.id!==e.id)):this.diasAsistencia>0&&(e.cupoHora++,this.diasAsistencia--,this.dataDiasHorarios.push({id:e.id,dia:e.dias,hora:e.horas,cupoHora:1}))}}isCellSelected(t,o){let e;return"string"==typeof this.dataDiasHorarios&&(e=JSON.parse(this.dataDiasHorarios)),"object"==typeof this.dataDiasHorarios&&(e=this.dataDiasHorarios),e.some(n=>n.dia===t&&n.hora===o)}trackByHora(t,o){return o}trackByDia(t,o){return o}confirmarCambiosCupo(){this.idServicio=this.config.data.id;const t=this.cambiosDataDiasHorarios.map(o=>({id:o.id,cupoHora:o.cupoHora,dia:o.dias,hora:o.horas}));this.serviciosService.modificarServicioDiasHorarios({id:this.idServicio,updDiasHorarios:t,diasHorarios:this.dataDiasHorarios}).subscribe(o=>{x().fire(o.msg,"",o.icon),o.ok&&this.closeForm()})}closeForm(){this.ref.close()}static#i=this.\u0275fac=function(o){return new(o||a)(i.Y36(g.E7),i.Y36(g.S),i.Y36(f.YP),i.Y36(w),i.Y36(S))};static#t=this.\u0275cmp=i.Xpm({type:a,selectors:[["app-tabla-reserva-cliente"]],features:[i._Bn([f.YP])],decls:61,vars:14,consts:[[1,"col-12","px-0","mx-0","mb-3","w-100"],[1,"data-box"],[1,"data-item"],[1,"data-label"],[1,"data-value"],[1,"data-box","mt-3"],[1,"flex","justify-content-between","legend"],[1,"legend-item"],[1,"legend-color",2,"background-color","#ffaaaa"],[1,"legend-code"],[1,"legend-color",2,"background-color","#aaffaa"],[1,"legend-color",2,"background-color","#8bcae7"],[4,"ngFor","ngForOf"],[1,"text-center","col-12","p-3","m-0"],["label","Confirmar",3,"disabled","onClick"],["class","cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"ngClass","click"]],template:function(o,e){1&o&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"span",3),i._uU(4,"Nombre:"),i.qZA(),i.TgZ(5,"span",4),i._uU(6),i.qZA()(),i.TgZ(7,"div",2)(8,"span",3),i._uU(9,"Apellido:"),i.qZA(),i.TgZ(10,"span",4),i._uU(11),i.qZA()(),i.TgZ(12,"div",2)(13,"span",3),i._uU(14,"DNI:"),i.qZA(),i.TgZ(15,"span",4),i._uU(16),i.qZA()(),i.TgZ(17,"div",2)(18,"span",3),i._uU(19,"Email:"),i.qZA(),i.TgZ(20,"span",4),i._uU(21),i.qZA()(),i.TgZ(22,"div",2)(23,"span",3),i._uU(24,"Tel\xe9fono:"),i.qZA(),i.TgZ(25,"span",4),i._uU(26),i.qZA()(),i.TgZ(27,"div",2)(28,"span",3),i._uU(29,"Plan:"),i.qZA(),i.TgZ(30,"span",4),i._uU(31),i.qZA()(),i.TgZ(32,"div",2)(33,"span",3),i._uU(34,"Descripci\xf3n del plan:"),i.qZA(),i.TgZ(35,"span",4),i._uU(36),i.qZA()()(),i.TgZ(37,"div",5)(38,"div",6)(39,"span",7),i._UZ(40,"span",8),i._uU(41,"Sin asignar "),i._UZ(42,"span",9),i.qZA(),i.TgZ(43,"span",7),i._UZ(44,"span",10),i._uU(45,"Asignados "),i._UZ(46,"span",9),i.qZA(),i.TgZ(47,"span",7),i._UZ(48,"span",11),i._uU(49,"Seleccionado "),i._UZ(50,"span",9),i.qZA()()()(),i.TgZ(51,"table")(52,"thead")(53,"tr")(54,"th"),i._uU(55),i.qZA(),i.YNc(56,k,2,1,"th",12),i.qZA()(),i.TgZ(57,"tbody"),i.YNc(58,Y,4,2,"tr",12),i.qZA()(),i.TgZ(59,"div",13)(60,"p-button",14),i.NdJ("onClick",function(){return e.confirmarCambiosCupo()}),i.qZA()()),2&o&&(i.xp6(6),i.Oqu(e.config.data.cliente.nombre),i.xp6(5),i.Oqu(e.config.data.cliente.apellido),i.xp6(5),i.Oqu(e.config.data.cliente.dni),i.xp6(5),i.Oqu(e.config.data.cliente.email),i.xp6(5),i.Oqu(e.config.data.cliente.telefono),i.xp6(5),i.Oqu(e.config.data.plan.nombre),i.xp6(5),i.Oqu(e.config.data.plan.descripcion),i.xp6(19),i.hij("Resta ",1==e.diasAsistencia?e.diasAsistencia+" d\xeda":e.diasAsistencia+" d\xedas",""),i.xp6(1),i.Q6J("ngForOf",e.diasDisponibles),i.xp6(2),i.Q6J("ngForOf",e.horasDisponibles),i.xp6(2),i.Akn(i.DdM(13,E)),i.Q6J("disabled",0!==e.diasAsistencia))},dependencies:[h.mk,h.sg,T.zx],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:center;border:1px solid #ddd;width:100px}th[_ngcontent-%COMP%]{background-color:#f2f2f2}.cupo-disponible[_ngcontent-%COMP%]{background-color:#afa}.cupo-agotado[_ngcontent-%COMP%]{background-color:#faa}.celda-seleccionada[_ngcontent-%COMP%]{background-color:#8bcae7!important}.grid[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important}.legend[_ngcontent-%COMP%]{display:flex;justify-content:space-between}@media (max-width: 480px){.legend[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.legend-item[_ngcontent-%COMP%]{margin-bottom:10px}}.data-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.data-value[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}"]})}return a})();var Q=s(4445),F=s(7101),P=s(3608),q=s(2137),$=s(2210),R=s(1236);function j(a,r){1&a&&(i.TgZ(0,"div"),i._uU(1," Cliente requerido. "),i.qZA())}function B(a,r){if(1&a&&(i.TgZ(0,"div",13),i.YNc(1,j,2,0,"div",3),i.qZA()),2&a){const t=i.oxw(2);let o;i.xp6(1),i.Q6J("ngIf",null==(o=t.miFormulario.get("idCliente"))?null:o.hasError("required"))}}const u=function(){return{margin:".5em",width:"9rem"}};function G(a,r){if(1&a){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",5)(2,"label",6),i._uU(3,"Cliente"),i.TgZ(4,"span",7),i._uU(5,"*"),i.qZA()(),i._UZ(6,"p-dropdown",8),i.TgZ(7,"div",9),i.YNc(8,B,2,1,"div",10),i.qZA()(),i.TgZ(9,"div",11)(10,"p-button",12),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),i.qZA()(),i.BQk()}if(2&a){const t=i.oxw();let o;i.xp6(6),i.Q6J("options",t.clientes)("filter",!0)("showClear",!0),i.xp6(2),i.Q6J("ngIf",null==(o=t.miFormulario.get("idCliente"))?null:o.touched),i.xp6(2),i.Akn(i.DdM(7,u)),i.Q6J("disabled",t.miFormulario.get("idCliente").invalid)}}function K(a,r){1&a&&(i.TgZ(0,"div"),i._uU(1," Plan requerido. "),i.qZA())}function V(a,r){if(1&a&&(i.TgZ(0,"div",13),i.YNc(1,K,2,0,"div",3),i.qZA()),2&a){const t=i.oxw(2);let o;i.xp6(1),i.Q6J("ngIf",null==(o=t.miFormulario.get("idPlan"))?null:o.hasError("required"))}}function L(a,r){if(1&a){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",5)(2,"label",14),i._uU(3,"Planes"),i.TgZ(4,"span",7),i._uU(5,"*"),i.qZA()(),i.TgZ(6,"p-dropdown",15),i.NdJ("onChange",function(e){i.CHM(t);const n=i.oxw();return i.KtG(n.selectedPlan(e))}),i.qZA(),i.TgZ(7,"div",9),i.YNc(8,V,2,1,"div",10),i.qZA()(),i.TgZ(9,"div",11)(10,"p-button",16),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),i.qZA(),i.TgZ(11,"p-button",12),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),i.qZA()(),i.BQk()}if(2&a){const t=i.oxw();let o;i.xp6(6),i.Q6J("options",t.planes)("filter",!0)("showClear",!0),i.xp6(2),i.Q6J("ngIf",null==(o=t.miFormulario.get("idPlan"))?null:o.touched),i.xp6(2),i.Akn(i.DdM(9,u)),i.xp6(1),i.Akn(i.DdM(10,u)),i.Q6J("disabled",t.miFormulario.get("idPlan").invalid)}}function X(a,r){if(1&a&&(i.TgZ(0,"th"),i._uU(1),i.qZA()),2&a){const t=r.$implicit;i.xp6(1),i.Oqu(t)}}const W=function(a,r,t){return{"cupo-disponible":a,"cupo-agotado":r,"celda-seleccionada":t}};function ii(a,r){if(1&a){const t=i.EpF();i.TgZ(0,"td",28),i.NdJ("click",function(){const n=i.CHM(t).$implicit,c=i.oxw().$implicit,d=i.oxw(3);return i.KtG(d.asignarHorasDiasCupo(n,c))}),i._uU(1),i.qZA()}if(2&a){const t=r.$implicit,o=i.oxw().$implicit,e=i.oxw(3);i.Q6J("ngClass",i.kEZ(2,W,e.getCupoHora(t,o)>0,0===e.getCupoHora(t,o),e.isCellSelected(t,o))),i.xp6(1),i.hij(" ",e.getCupoHora(t,o)," ")}}function ti(a,r){if(1&a&&(i.TgZ(0,"tr")(1,"td"),i._uU(2),i.qZA(),i.YNc(3,ii,2,6,"td",27),i.qZA()),2&a){const t=r.$implicit,o=i.oxw(3);i.xp6(2),i.hij("",t," hs."),i.xp6(1),i.Q6J("ngForOf",o.diasDisponibles)}}function ei(a,r){if(1&a&&(i.TgZ(0,"div",18)(1,"div",19)(2,"div",20)(3,"span",21),i._UZ(4,"span",22),i._uU(5,"Sin asignar "),i._UZ(6,"span",23),i.qZA(),i.TgZ(7,"span",21),i._UZ(8,"span",24),i._uU(9,"Asignados "),i._UZ(10,"span",23),i.qZA(),i.TgZ(11,"span",21),i._UZ(12,"span",25),i._uU(13,"Seleccionado "),i._UZ(14,"span",23),i.qZA()()(),i.TgZ(15,"table")(16,"thead")(17,"tr")(18,"th"),i._uU(19),i.qZA(),i.YNc(20,X,2,1,"th",26),i.qZA()(),i.TgZ(21,"tbody"),i.YNc(22,ti,4,2,"tr",26),i.qZA()()()),2&a){const t=i.oxw(2);i.xp6(19),i.hij("Resta ",1==t.diasAsistencia?t.diasAsistencia+" d\xeda":t.diasAsistencia+" d\xedas",""),i.xp6(1),i.Q6J("ngForOf",t.diasDisponibles),i.xp6(2),i.Q6J("ngForOf",t.horasDisponibles)}}function oi(a,r){if(1&a){const t=i.EpF();i.ynx(0),i.YNc(1,ei,23,3,"div",17),i.TgZ(2,"div",11)(3,"p-button",16),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),i.qZA(),i.TgZ(4,"p-button",12),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep))}),i.qZA()(),i.BQk()}if(2&a){const t=i.oxw();i.xp6(1),i.Q6J("ngIf",t.diasHorasSucursal.length>0),i.xp6(2),i.Akn(i.DdM(6,u)),i.xp6(1),i.Akn(i.DdM(7,u)),i.Q6J("disabled",0!==t.diasAsistencia)}}function ai(a,r){if(1&a){const t=i.EpF();i.ynx(0),i.TgZ(1,"div",29)(2,"h3",30),i._uU(3,"\xbfConfirmar reserva?"),i.qZA()(),i.TgZ(4,"div",11)(5,"p-button",16),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.avanzarAlSiguientePaso(e.currentStep-2))}),i.qZA(),i._UZ(6,"p-button",31),i.TgZ(7,"p-button",32),i.NdJ("onClick",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.closeForm({result:!1}))}),i.qZA()(),i.BQk()}if(2&a){const t=i.oxw();i.xp6(5),i.Akn(i.DdM(7,u)),i.xp6(1),i.Akn(i.DdM(8,u)),i.Q6J("disabled",t.miFormulario.invalid),i.xp6(1),i.Akn(i.DdM(9,u))}}let M=(()=>{class a{constructor(t,o,e,n,c,d,m,l,Pi){this.ref=t,this.config=o,this.fb=e,this.confirmationService=n,this.clienteService=c,this.planService=d,this.diasHorariosSucursalService=m,this.serviciosService=l,this.router=Pi,this.currentStep=0,this.idPlan=0,this.importe=0,this.diasAsistencia=0,this.dataDiasHorarios=[],this.cambiosDataDiasHorarios=[],this.subscriptions=[],this.miFormulario=this.fb.group({idCliente:new p.NI({value:"",disabled:!1},[p.kI.required]),idPlan:new p.NI({value:"",disabled:!1},[p.kI.required]),importe:new p.NI({value:0,disabled:!1},[p.kI.required]),diasHorarios:new p.NI({value:"",disabled:!1}),updDiasHorarios:new p.NI({value:"",disabled:!1}),fechaInicio:new p.NI({value:null,disabled:!1}),fechaFin:new p.NI({value:null,disabled:!1})}),this.clienteService.traerClientes().subscribe(A=>{this.clientes=A.filter(D=>D.estado)}),this.planService.traerPlanes().subscribe(A=>{this.planes=A.filter(D=>D.estado)})}ngOnInit(){const t=this.config.data;t&&(this.miFormulario.patchValue({idCliente:Number(t)}),this.avanzarAlSiguientePaso(0)),this.items=[{label:"Cliente"},{label:"Planes"},{label:"D\xedas y horarios"},{label:"Confirmaci\xf3n"}]}avanzarAlSiguientePaso(t){this.currentStep=t+=1}selectedPlan(t){this.idPlan=t.value.id,this.plazoValidez=t.value.id;const o=this.miFormulario.get("idCliente").value,e=this.serviciosService.buscarServicioClientePlan({idCliente:o,idPlan:this.idPlan}).subscribe(d=>{d.ok&&(x().fire(d.msg,"",d.icon),this.miFormulario.patchValue({idPlan:null}))});this.subscriptions.push(e),this.importe=t.value.importe;const n=t.value.idSucursal;this.diasAsistencia=t.value.diasAsistencia;const c=this.diasHorariosSucursalService.traerDiasHorariosSucursal(n).subscribe(d=>{this.diasHorasSucursal=d,this.diasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(m=>m.dias))),this.horasDisponibles=Array.from(new Set(this.diasHorasSucursal.map(m=>m.horas)))});this.subscriptions.push(c)}getCupoHora(t,o){const e=this.diasHorasSucursal.find(n=>n.dias===t&&n.horas===o);return e?e.cupoHora:0}asignarHorasDiasCupo(t,o){const e=this.diasHorasSucursal.find(n=>n.dias===t&&n.horas===o);if(e){let n;if("string"==typeof this.dataDiasHorarios)try{n=JSON.parse(this.dataDiasHorarios)}catch(l){console.error("Error al convertir LONGTEXT a JSON:",l),n={}}else n=this.dataDiasHorarios;const d=Object.values(n).some(l=>l.id===e.id);this.cambiosDataDiasHorarios?.find(l=>l.id===e.id)?(this.cambiosDataDiasHorarios=this.cambiosDataDiasHorarios.filter(l=>l.id!==e.id),this.cambiosDataDiasHorarios.push(e)):this.cambiosDataDiasHorarios.push(e),d?e.cupoHora>0&&(e.cupoHora--,this.diasAsistencia++,this.dataDiasHorarios=this.dataDiasHorarios.filter(l=>l.id!==e.id)):this.diasAsistencia>0&&(e.cupoHora++,this.diasAsistencia--,this.dataDiasHorarios.push({id:e.id,dia:e.dias,hora:e.horas,cupoHora:1}))}}isCellSelected(t,o){return Object.values(this.dataDiasHorarios).some(n=>n.dia===t&&n.hora===o)}guardar(){const t=this.cambiosDataDiasHorarios.map(o=>({id:o.id,dia:o.dias,hora:o.horas,cupoHora:o.cupoHora}));this.miFormulario.patchValue({idPlan:this.idPlan,importe:this.importe,updDiasHorarios:t,diasHorarios:this.dataDiasHorarios}),this.serviciosService.crearServicio(this.miFormulario.value).subscribe(o=>{o.ok?x().fire(o.msg,"",o.icon).then(e=>{e.isConfirmed&&this.confirmationService.confirm({message:"\xbfDeseas realizar el cobro al cliente?",header:"Confirmaci\xf3n",icon:"pi pi-exclamation-triangle",accept:()=>{this.closeForm({result:!0,servicio:{...o.servicio,plan:{plazoValidez:this.plazoValidez}}})},reject:()=>{this.router.navigate(["servicios"])}})}):this.closeForm({result:!1})})}closeForm(t){this.ref.close(t)}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static#i=this.\u0275fac=function(o){return new(o||a)(i.Y36(g.E7),i.Y36(g.S),i.Y36(p.qu),i.Y36(f.YP),i.Y36(Q.$),i.Y36(F.D),i.Y36(w),i.Y36(S),i.Y36(C.F0))};static#t=this.\u0275cmp=i.Xpm({type:a,selectors:[["app-formulario-servicios"]],features:[i._Bn([f.YP])],decls:8,vars:8,consts:[[3,"model","readonly","activeIndex"],["autocomplete","off",1,"pt-2",3,"formGroup","ngSubmit"],[1,"grid"],[4,"ngIf"],[1,"confirmation"],[1,"col-12","lg:col-6","p-3","m-0","mt-3"],["htmlFor","idCliente"],["pTooltip","Requerido","tooltipPosition","top",1,"required"],["formControlName","idCliente","optionLabel","nombre","optionValue","id","filterBy","nombre","placeholder","Seleccione cliente","appendTo","body","emptyFilterMessage","Sin resultados","emptyMessage","Sin resultados",3,"options","filter","showClear"],[1,"h-1rem"],["class","error-message",4,"ngIf"],[1,"text-center","col-12","p-3","m-0"],["label","Siguiente",3,"disabled","onClick"],[1,"error-message"],["htmlFor","idPlan"],["formControlName","idPlan","optionLabel","nombre","filterBy","nombre","placeholder","Seleccione plan","appendTo","body","emptyFilterMessage","Sin resultados","emptyMessage","Sin resultados",3,"options","filter","showClear","onChange"],["label","Anterior",3,"onClick"],["class","col-12 mt-3 mb-3 w-100",4,"ngIf"],[1,"col-12","mt-3","mb-3","w-100"],[1,"data-box","mt-3","mb-3"],[1,"flex","justify-content-between","legend"],[1,"legend-item"],[1,"legend-color",2,"background-color","#ffaaaa"],[1,"legend-code"],[1,"legend-color",2,"background-color","#aaffaa"],[1,"legend-color",2,"background-color","#8bcae7"],[4,"ngFor","ngForOf"],["class","cursor-pointer",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"cursor-pointer",3,"ngClass","click"],[1,"text-center","col-12","p-3","m-0","mt-3"],[1,"m-5"],["label","Confirmar","type","submit","icon","pi pi-check","styleClass","p-button-success",3,"disabled"],["label","Cancelar","icon","pi pi-times","styleClass","p-button-secondary",3,"onClick"]],template:function(o,e){1&o&&(i._UZ(0,"p-steps",0),i.TgZ(1,"form",1),i.NdJ("ngSubmit",function(){return e.guardar()}),i.TgZ(2,"div",2),i.YNc(3,G,11,8,"ng-container",3),i.YNc(4,L,12,11,"ng-container",3),i.YNc(5,oi,5,8,"ng-container",3),i.YNc(6,ai,8,10,"ng-container",3),i.qZA()(),i._UZ(7,"p-confirmDialog",4)),2&o&&(i.Q6J("model",e.items)("readonly",!0)("activeIndex",e.currentStep),i.xp6(1),i.Q6J("formGroup",e.miFormulario),i.xp6(2),i.Q6J("ngIf",0===e.currentStep),i.xp6(1),i.Q6J("ngIf",1===e.currentStep),i.xp6(1),i.Q6J("ngIf",2===e.currentStep),i.xp6(1),i.Q6J("ngIf",3===e.currentStep))},dependencies:[h.mk,h.sg,h.O5,p._Y,p.JJ,p.JL,p.sg,p.u,P.u,T.zx,q.Q,$.Lt,R.R],styles:["table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff;z-index:1}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px;text-align:center;border:1px solid #ddd;width:100px}th[_ngcontent-%COMP%]{background-color:#f2f2f2}.cupo-disponible[_ngcontent-%COMP%]{background-color:#afa}.cupo-agotado[_ngcontent-%COMP%]{background-color:#faa}.celda-seleccionada[_ngcontent-%COMP%]{background-color:#8bcae7!important}.grid[_ngcontent-%COMP%]{display:flex!important;justify-content:center!important}.legend[_ngcontent-%COMP%]{display:flex;justify-content:space-between}@media (max-width: 480px){.legend[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.legend-item[_ngcontent-%COMP%]{margin-bottom:10px}}.data-item[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.data-value[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}"]})}return a})();class Z extends Error{}Z.prototype.name="InvalidTokenError";var ci=s(7154),li=s(308),pi=s(6679),di=s(1740),ui=s(4424),mi=s(7248),hi=s(1493),gi=s(8741),fi=s(6526),_i=s(5793);function vi(a,r){if(1&a){const t=i.EpF();i.TgZ(0,"div",16)(1,"span",17),i._UZ(2,"i",18),i.TgZ(3,"input",19),i.NdJ("input",function(e){i.CHM(t),i.oxw();const n=i.MAs(6);return i.KtG(n.filterGlobal(e.target.value,"contains"))}),i.qZA()(),i.TgZ(4,"span")(5,"button",20),i.NdJ("click",function(){i.CHM(t);const e=i.oxw();return i.KtG(e.show())}),i.qZA()()()}}function bi(a,r){1&a&&(i.TgZ(0,"tr")(1,"th"),i._uU(2,"Nombre"),i.qZA(),i.TgZ(3,"th"),i._uU(4,"DNI"),i.qZA(),i.TgZ(5,"th"),i._uU(6,"Plan"),i.qZA(),i.TgZ(7,"th"),i._uU(8,"Fecha inicio"),i.qZA(),i.TgZ(9,"th"),i._uU(10,"Fecha fin"),i.qZA(),i.TgZ(11,"th",21),i._uU(12,"D\xedas restantes"),i.qZA(),i.TgZ(13,"th",21),i._uU(14,"Importe"),i.qZA(),i.TgZ(15,"th",21),i._uU(16,"Cobro"),i.qZA(),i.TgZ(17,"th",22),i._uU(18,"Estado"),i.qZA(),i._UZ(19,"th"),i.qZA())}function Ci(a,r){if(1&a){const t=i.EpF();i.TgZ(0,"tr")(1,"td")(2,"span",23),i._uU(3,"Nombre"),i.qZA(),i._uU(4),i.qZA(),i.TgZ(5,"td")(6,"span",23),i._uU(7,"DNI"),i.qZA(),i._uU(8),i.ALo(9,"dniFormat"),i.qZA(),i.TgZ(10,"td")(11,"span",23),i._uU(12,"Plan"),i.qZA(),i.TgZ(13,"div",24),i._uU(14),i.qZA()(),i.TgZ(15,"td")(16,"span",23),i._uU(17,"Fecha inicio"),i.qZA(),i._uU(18),i.qZA(),i.TgZ(19,"td")(20,"span",23),i._uU(21,"Fecha fin"),i.qZA(),i._uU(22),i.qZA(),i.TgZ(23,"td",21)(24,"span",23),i._uU(25,"D\xedas restantes"),i.qZA(),i._uU(26),i.qZA(),i.TgZ(27,"td",21)(28,"span",23),i._uU(29,"Importe"),i.qZA(),i._uU(30),i.qZA(),i.TgZ(31,"td",21)(32,"span",23),i._uU(33,"Cobro"),i.qZA(),i._uU(34),i.qZA(),i.TgZ(35,"td",22)(36,"span",23),i._uU(37,"Estado"),i.qZA(),i._UZ(38,"p-tag",25),i.qZA(),i.TgZ(39,"td",26)(40,"p-speedDial",27),i.NdJ("onClick",function(){const n=i.CHM(t).$implicit,c=i.oxw();return i.KtG(c.accionBoton(n))}),i.qZA()()()}if(2&a){const t=r.$implicit,o=r.rowIndex,e=i.oxw();i.xp6(4),i.Oqu(null==t.cliente?null:t.cliente.nombre),i.xp6(4),i.Oqu(i.lcZ(9,12,null==t.cliente?null:t.cliente.dni)),i.xp6(5),i.s9C("pTooltip",null==t.plan?null:t.plan.descripcion),i.xp6(1),i.hij(" ",null==t.plan?null:t.plan.nombre,""),i.xp6(4),i.Oqu(t.fechaInicio),i.xp6(4),i.Oqu(t.fechaFin),i.xp6(4),i.Oqu(t.diasRestantes),i.xp6(4),i.hij("$",t.importe,""),i.xp6(4),i.hij("$",t.cobro?t.cobro:0,""),i.xp6(4),i.Q6J("value",t.estado)("severity",e.getSeverity(t.estado)),i.xp6(2),i.Q6J("model",e.items[o])}}function Zi(a,r){1&a&&(i.TgZ(0,"tr")(1,"td",28),i._uU(2,"No se encontraron registros"),i.qZA()()),2&a&&(i.xp6(1),i.uIk("colspan",9))}const xi=function(){return{"min-width":"20rem"}},Ti=function(){return["cliente.nombre","cliente.dni","plan.nombre","estado"]},Si=function(){return[10,25,50]},Ai=function(){return{width:"50vw"}},Di=function(){return{margin:".5em",width:"9rem"}};let O=(()=>{class a{constructor(t,o,e,n,c,d){this.serviciosService=t,this.planService=o,this.pagoService=e,this.dialogService=n,this.route=c,this.router=d,this.items=[],this.servicios=[],this.visible=!1,this.importeCobrado=0,this.importeMax=0}ngOnInit(){const t=this.route.snapshot.paramMap.get("idCliente");t&&this.show(t);const e=function si(a,r){if("string"!=typeof a)throw new Z("Invalid token specified: must be a string");r||(r={});const t=!0===r.header?0:1,o=a.split(".")[t];if("string"!=typeof o)throw new Z(`Invalid token specified: missing part #${t+1}`);let e;try{e=function ri(a){let r=a.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return function ni(a){return decodeURIComponent(atob(a).replace(/(.)/g,(r,t)=>{let o=t.charCodeAt(0).toString(16).toUpperCase();return o.length<2&&(o="0"+o),"%"+o}))}(r)}catch{return atob(r)}}(o)}catch(n){throw new Z(`Invalid token specified: invalid base64 for part #${t+1} (${n.message})`)}try{return JSON.parse(e)}catch(n){throw new Z(`Invalid token specified: invalid json for part #${t+1} (${n.message})`)}}(localStorage.getItem("token"));this.idUsuario=e.id,this.traerServicios()}accionBoton(t){this.planService.traerUnPlan(t.idPlan).subscribe(o=>{this.dataCliente={...t,idSucursal:o.idSucursal}})}traerServicios(){this.subscription=this.serviciosService.traerServicios().subscribe(t=>{this.servicios=t.sort((o,e)=>e.id-o.id),this.preCalcularValores(),this.items=this.servicios.map(o=>{const e=[{icon:"pi pi-id-card",tooltipOptions:{tooltipLabel:"Ver reserva",tooltipPosition:"top"},command:()=>{this.showHorasDias(this.dataCliente)}}];return"activo"!==o.estado&&e.push({icon:"pi pi-dollar",tooltipOptions:{tooltipLabel:"Pagar",tooltipPosition:"top"},command:()=>{this.visible=!0,this.importeCobrado=this.dataCliente.plan.importe-(this.dataCliente.cobro||0),this.importeMax=this.dataCliente.plan.importe-(this.dataCliente.cobro||0)}}),o.cliente.telefono&&e.push({icon:"pi pi-whatsapp",tooltipOptions:{tooltipLabel:"Enviar WhatsApp",tooltipPosition:"top"},command:()=>{const d=`https://wa.me/${this.dataCliente.cliente.telefono}?text=${encodeURIComponent(`Hola, \xbfc\xf3mo est\xe1s ${this.dataCliente.cliente.nombre}?`)}`;window.open(d,"_blank")}}),e})})}show(t){this.ref=this.dialogService.open(M,{header:"Nuevo servicio",width:"70%",contentStyle:{overflow:"auto"},maximizable:!0,styleClass:"customer-dialog-form",data:t}),this.ref.onClose.subscribe(o=>{o&&o.result&&(this.visible=!0,this.dataCliente=o.servicio,this.importeCobrado=o.servicio.importe||0,this.importeMax=o.servicio.importe||0),this.traerServicios()})}showHorasDias(t){this.ref=this.dialogService.open(z,{header:"Reserva",width:"70%",contentStyle:{overflow:"auto"},maximizable:!0,styleClass:"customer-dialog-form",data:t}),this.ref.onClose.subscribe(()=>{this.traerServicios()})}getSeverity(t){switch(t){case"activo":return"success";case"parcial":return"warning";case"pago pendiente":return"danger";default:return""}}preCalcularValores(){this.servicios.forEach(t=>{t.diasRestantes=this.calcularDiasRestantes(t.fechaFin),t.estado=this.calcularEstado(t.cobro||0,t.plan.importe,t.diasRestantes)})}calcularDiasRestantes(t){const o=new Date(t+"T00:00:00-03:00"),e=new Date;if(e.setHours(0,0,0,0),isNaN(o.getTime()))return 0;const n=o.getTime()-e.getTime(),c=Math.floor(n/864e5);return Math.max(0,c)}calcularEstado(t,o,e){return 0===t||0===e?"pago pendiente":t<o?"parcial":"activo"}enviarCobro(){this.pagoService.crearPago({idServicio:this.dataCliente.id,idUsuario:this.idUsuario,importe:this.importeCobrado,plazoValidez:this.dataCliente.plan.plazoValidez,cobro:this.dataCliente.cobro}).subscribe(o=>{x().fire(o.msg,"",o.icon),o.ok&&(this.visible=!1,this.router.navigate(["servicios"]))})}ngOnDestroy(){this.ref&&this.ref.close({result:!1}),this.subscription.unsubscribe()}static#i=this.\u0275fac=function(o){return new(o||a)(i.Y36(S),i.Y36(F.D),i.Y36(ci.e),i.Y36(g.xA),i.Y36(C.gz),i.Y36(C.F0))};static#t=this.\u0275cmp=i.Xpm({type:a,selectors:[["app-tabla-servicios"]],features:[i._Bn([g.xA,f.YP])],decls:23,vars:25,consts:[[1,"card"],["dataKey","id","responsiveLayout","stack","currentPageReportTemplate","{first} al {last} de {totalRecords}",3,"value","tableStyle","paginator","rows","showCurrentPageReport","globalFilterFields","rowsPerPageOptions"],["dt",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"confirmation"],["header","Cobro de servicio",1,"customer-dialog-form",3,"visible","baseZIndex","modal","visibleChange"],[1,"pl-0","ml-0"],[1,"col-12","w-100","pl-0"],["htmlFor","importe",1,"m-0"],["pTooltip","Requerido","tooltipPosition","top",1,"required"],["inputId","importe","placeholder","$ 0,00","mode","currency","currency","ARS","locale","es-AR",1,"m-0",3,"ngModel","min","max","ngModelChange"],[1,"text-center","col-12","p-3","m-0"],["label","Cobrar","type","button","icon","pi pi-dollar","styleClass","p-button-success",3,"disabled","onClick"],[1,"flex","align-items-center","justify-content-between","my-0","py-0"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Buscar...",3,"input"],["pButton","","pRipple","","icon","pi pi-plus","pTooltip","Nuevo servicio","tooltipPosition","left",1,"p-button-success","mr-2",3,"click"],[1,"text-right"],[1,"text-center"],[1,"p-column-title"],["tooltipPosition","top",1,"m-0","p-0","cursor-pointer",3,"pTooltip"],[1,"uppercase",3,"value","severity"],[1,"text-left"],["direction","left","showIcon","pi pi-ellipsis-h","hideIcon","pi pi-times",3,"model","onClick"],[1,"text-center",2,"color","grey"]],template:function(o,e){1&o&&(i._UZ(0,"app-tool-bar"),i.TgZ(1,"h1"),i._uU(2,"Servicios"),i.qZA(),i._UZ(3,"hr"),i.TgZ(4,"div",0)(5,"p-table",1,2),i.YNc(7,vi,6,0,"ng-template",3),i.YNc(8,bi,20,0,"ng-template",4),i.YNc(9,Ci,41,14,"ng-template",5),i.YNc(10,Zi,3,1,"ng-template",6),i.qZA()(),i._UZ(11,"app-footer")(12,"p-confirmDialog",7),i.TgZ(13,"p-dialog",8),i.NdJ("visibleChange",function(c){return e.visible=c}),i.TgZ(14,"div",9)(15,"div",10)(16,"label",11),i._uU(17,"Importe"),i.TgZ(18,"span",12),i._uU(19,"*"),i.qZA()(),i.TgZ(20,"p-inputNumber",13),i.NdJ("ngModelChange",function(c){return e.importeCobrado=c}),i.qZA()(),i.TgZ(21,"div",14)(22,"p-button",15),i.NdJ("onClick",function(){return e.enviarCobro()}),i.qZA()()()()),2&o&&(i.xp6(5),i.Q6J("value",e.servicios)("tableStyle",i.DdM(20,xi))("paginator",e.servicios.length>10)("rows",5)("showCurrentPageReport",!0)("globalFilterFields",i.DdM(21,Ti))("rowsPerPageOptions",i.DdM(22,Si)),i.xp6(8),i.Akn(i.DdM(23,Ai)),i.Q6J("visible",e.visible)("baseZIndex",19e3)("modal",!0),i.xp6(7),i.Udp("width",100,"%"),i.Q6J("ngModel",e.importeCobrado)("min",0)("max",e.importeMax),i.xp6(2),i.Akn(i.DdM(24,Di)),i.Q6J("disabled",e.importeCobrado<=0))},dependencies:[p.JJ,P.u,f.jx,T.Hq,T.zx,q.Q,li.iA,pi.V,di.o,ui.V,mi.Rn,hi.V,gi.o,fi.c,p.On,_i.p],styles:["*[_ngcontent-%COMP%]{margin:15px}.card[_ngcontent-%COMP%]{border:1px solid var(--surface-border)!important;border-radius:12px!important}"]})}return a})();const Hi=[{path:"",children:[{path:"",component:O},{path:":idCliente",component:O},{path:"form-servicios",component:M},{path:"**",redirectTo:"auth"}]}];let Ui=(()=>{class a{static#i=this.\u0275fac=function(o){return new(o||a)};static#t=this.\u0275mod=i.oAB({type:a});static#e=this.\u0275inj=i.cJS({imports:[C.Bz.forChild(Hi),C.Bz]})}return a})();var yi=s(6867),wi=s(4466);let Fi=(()=>{class a{static#i=this.\u0275fac=function(o){return new(o||a)};static#t=this.\u0275mod=i.oAB({type:a});static#e=this.\u0275inj=i.cJS({imports:[h.ez,p.UX,Ui,yi.g,wi.m,p.u5]})}return a})()}}]);